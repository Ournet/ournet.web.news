extends _layouts/news

block append meta
  meta(property='og:title', content=story.title)
  meta(property='og:type', content='article')
  meta(property='og:image', content=links.wi('large', story.imageId))

  meta(property='article:published_time', content=story.createdAt.toISOString())
  meta(property='article:publisher', content=config.name)
  if (category)
    meta(property='article:section', content=category[currentCulture.lang])
  each item in story.topics
    if (item.abbr)
      meta(property='article:tag', content=item.abbr)  
    meta(property='article:tag', content=item.name)


block main_content
  .content-box#story-page
    article
      - var hasVideo = story.videos && story.videos.length > 0
      header
        .story-image
          if (hasVideo)
            .fine-image.has-video
              img.story-img(alt=story.title, src=links.wi('master', story.imageId))
              .video-icon
                i
          else
            .fine-image
              a(rel='nofollow', href=links.wi('master', story.imageId), target='_blank')
                img.story-img(alt=story.title, src=links.wi('master', story.imageId))
            .image-source=__('photo')+': '+ story.imageHost
        h1
          a(href=links.story(story.uniqueName, story.id))= story.title
        .row
          .col-xs-6
            .item-details= util.format(__('news_count'), story.countNews)
              |,  
              span.stats-badge(title=__('views'))= story.countViews
                |  
                i.icon.icon-views
              |  
              time(datetime=story.createdAt.toISOString())= util.moment.tz(story.createdAt, config.timezone).locale(currentCulture.lang).format('lll')
          .col-xs-6.text-right
            .social-likes(data-url=site.head.canonical)
              each item in config.shareDataServices
                div(class=item)
        .item-body!= util.summaryToParagraphs(story.summary)

    a.read-source(rel='nofollow', target='_blank', href=util.toUrl(story))= util.format(__('read_more_on_source'), story.host.replace(/^www\./, ''))
    br
    br
    +topicListTags(story.topics)

    if (quotes && quotes.length>0)
      br
      +quotesList(quotes)
    br
    .group.text-center
      include ./controls/ads_bottom
    br
    .fb-comments(data-href=site.head.canonical, data-numposts="5", data-width="100%")

block append second_content
  if (relatedNews && relatedNews.length>0)
    .group
      .group-title
        h4= __('related_news')
      .group-content
        +newsSimpleView(relatedNews)

  .group
    .group-title
      h4= __('latest_news')
    .tab-content
      +storiesSimpleView(latestStories)

block append scripts
  if (story.videos)
    - var videoFrame = links.videoFrame(story.videos.join(','),{ul: currentCulture.lang});
      script.
        $(document).ready(function(){
          $('.has-video', '.story-image').click(function(){
            $(this).html('<iframe src="#{videoFrame}" frameborder=0 scrolling="no" allowfullscreen="true"></iframe>');
            ga('send', 'event', 'video', 'play', '#{videoFrame}');
          });
        });
  script.
    (function() {
    var img = new Image();
    img.src = '#{links.actions.viewStory(story.id)}';
    }());
